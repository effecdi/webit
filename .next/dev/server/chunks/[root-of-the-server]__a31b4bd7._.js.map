{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/stripe-client.ts"],"sourcesContent":["import Stripe from 'stripe';\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  const connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n  return new Stripe(secretKey, {\n    apiVersion: '2025-08-27.basil' as any,\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,eAAe;IACb,MAAM,WAAW,QAAQ,GAAG,CAAC,0BAA0B;IACvD,MAAM,eAAe,QAAQ,GAAG,CAAC,aAAa,GAC1C,UAAU,QAAQ,GAAG,CAAC,aAAa,GACnC,QAAQ,GAAG,CAAC,gBAAgB,GAC1B,UAAU,QAAQ,GAAG,CAAC,gBAAgB,GACtC;IAEN,IAAI,CAAC,cAAc;QACjB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,gBAAgB;IACtB,MAAM,eAAe,QAAQ,GAAG,CAAC,iBAAiB,KAAK;IACvD,MAAM,oBAAoB,eAAe,eAAe;IAExD,MAAM,MAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,SAAS,kBAAkB,CAAC;IAC3D,IAAI,YAAY,CAAC,GAAG,CAAC,mBAAmB;IACxC,IAAI,YAAY,CAAC,GAAG,CAAC,mBAAmB;IACxC,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe;IAEpC,MAAM,WAAW,MAAM,MAAM,IAAI,QAAQ,IAAI;QAC3C,SAAS;YACP,UAAU;YACV,kBAAkB;QACpB;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,MAAM,qBAAqB,KAAK,KAAK,EAAE,CAAC,EAAE;IAE1C,IAAI,CAAC,sBAAuB,CAAC,mBAAmB,QAAQ,CAAC,WAAW,IAAI,CAAC,mBAAmB,QAAQ,CAAC,MAAM,EAAG;QAC5G,MAAM,IAAI,MAAM,CAAC,OAAO,EAAE,kBAAkB,qBAAqB,CAAC;IACpE;IAEA,OAAO;QACL,gBAAgB,mBAAmB,QAAQ,CAAC,WAAW;QACvD,WAAW,mBAAmB,QAAQ,CAAC,MAAM;IAC/C;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,OAAO,IAAI,0PAAM,CAAC,WAAW;QAC3B,YAAY;IACd;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,cAAc,EAAE,GAAG,MAAM;IACjC,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,OAAO;AACT;AAEA,IAAI,aAAkB;AAEf,eAAe;IACpB,IAAI,CAAC,YAAY;QACf,MAAM,EAAE,UAAU,EAAE,GAAG;QACvB,MAAM,YAAY,MAAM;QAExB,aAAa,IAAI,WAAW;YAC1B,YAAY;gBACV,kBAAkB,QAAQ,GAAG,CAAC,YAAY;gBAC1C,KAAK;YACP;YACA,iBAAiB;QACnB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/stripe-init.ts"],"sourcesContent":["import { runMigrations } from 'stripe-replit-sync';\nimport { getStripeSync } from '@/lib/stripe-client';\n\nlet initialized = false;\nlet initPromise: Promise<void> | null = null;\n\nexport async function ensureStripeInitialized() {\n  if (initialized) return;\n  if (initPromise) return initPromise;\n\n  initPromise = (async () => {\n    const databaseUrl = process.env.DATABASE_URL;\n    if (!databaseUrl) {\n      console.error('DATABASE_URL not set, skipping Stripe init');\n      return;\n    }\n\n    try {\n      console.log('Initializing Stripe schema...');\n      await runMigrations({ databaseUrl });\n      console.log('Stripe schema ready');\n\n      const stripeSync = await getStripeSync();\n\n      const domain = process.env.REPLIT_DOMAINS?.split(',')[0] || process.env.REPLIT_DEV_DOMAIN;\n      if (domain) {\n        try {\n          console.log('Setting up managed webhook...');\n          const result = await stripeSync.findOrCreateManagedWebhook(\n            `https://${domain}/api/stripe/webhook`\n          );\n          console.log('Webhook setup result:', JSON.stringify(result, null, 2).substring(0, 200));\n        } catch (webhookErr: any) {\n          console.warn('Webhook setup warning (non-fatal):', webhookErr.message);\n        }\n      }\n\n      stripeSync.syncBackfill()\n        .then(() => console.log('Stripe data synced'))\n        .catch((err: any) => console.error('Error syncing Stripe data:', err));\n\n      initialized = true;\n    } catch (error) {\n      console.error('Failed to initialize Stripe:', error);\n      initPromise = null;\n    }\n  })();\n\n  return initPromise;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI,cAAc;AAClB,IAAI,cAAoC;AAEjC,eAAe;IACpB,IAAI,aAAa;IACjB,IAAI,aAAa,OAAO;IAExB,cAAc,CAAC;QACb,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;QAC5C,IAAI,CAAC,aAAa;YAChB,QAAQ,KAAK,CAAC;YACd;QACF;QAEA,IAAI;YACF,QAAQ,GAAG,CAAC;YACZ,MAAM,IAAA,4SAAa,EAAC;gBAAE;YAAY;YAClC,QAAQ,GAAG,CAAC;YAEZ,MAAM,aAAa,MAAM,IAAA,0IAAa;YAEtC,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI,QAAQ,GAAG,CAAC,iBAAiB;YACzF,IAAI,QAAQ;gBACV,IAAI;oBACF,QAAQ,GAAG,CAAC;oBACZ,MAAM,SAAS,MAAM,WAAW,0BAA0B,CACxD,CAAC,QAAQ,EAAE,OAAO,mBAAmB,CAAC;oBAExC,QAAQ,GAAG,CAAC,yBAAyB,KAAK,SAAS,CAAC,QAAQ,MAAM,GAAG,SAAS,CAAC,GAAG;gBACpF,EAAE,OAAO,YAAiB;oBACxB,QAAQ,IAAI,CAAC,sCAAsC,WAAW,OAAO;gBACvE;YACF;YAEA,WAAW,YAAY,GACpB,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,uBACvB,KAAK,CAAC,CAAC,MAAa,QAAQ,KAAK,CAAC,8BAA8B;YAEnE,cAAc;QAChB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,cAAc;QAChB;IACF,CAAC;IAED,OAAO;AACT"}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/db/schema.ts"],"sourcesContent":["import { pgTable, serial, text, varchar, boolean, timestamp, numeric, jsonb, integer } from 'drizzle-orm/pg-core';\nimport { sql } from 'drizzle-orm';\n\nexport const users = pgTable('users', {\n  id: varchar('id').primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar('email'),\n  firstName: varchar('first_name'),\n  lastName: varchar('last_name'),\n  profileImageUrl: varchar('profile_image_url'),\n  stripeCustomerId: varchar('stripe_customer_id'),\n  stripeSubscriptionId: varchar('stripe_subscription_id'),\n  subscriptionPlan: varchar('subscription_plan').default('free'),\n  subscriptionStatus: varchar('subscription_status').default('inactive'),\n  createdAt: timestamp('created_at').defaultNow(),\n  updatedAt: timestamp('updated_at').defaultNow(),\n});\n\nexport const profiles = pgTable('profiles', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  username: text('username'),\n  partnerName: text('partner_name'),\n  firstMeetDate: timestamp('first_meet_date'),\n  coupleIntro: text('couple_intro'),\n  isMembershipActive: boolean('is_membership_active').default(false),\n  membershipTier: text('membership_tier').default('free'),\n  currentMode: text('current_mode').default('love'),\n  myMood: text('my_mood').default('heart'),\n  partnerMood: text('partner_mood').default('heart'),\n  stripeCustomerId: varchar('stripe_customer_id'),\n  stripeSubscriptionId: varchar('stripe_subscription_id'),\n  subscriptionPlan: varchar('subscription_plan').default('free'),\n  subscriptionStatus: varchar('subscription_status').default('inactive'),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const events = pgTable('events', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  title: text('title').notNull(),\n  description: text('description'),\n  date: timestamp('date').notNull(),\n  time: text('time'),\n  location: text('location'),\n  category: text('category'),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const todos = pgTable('todos', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  text: text('text').notNull(),\n  completed: boolean('completed').default(false),\n  assignee: text('assignee').default('we'),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const todoComments = pgTable('todo_comments', {\n  id: serial('id').primaryKey(),\n  todoId: integer('todo_id').notNull(),\n  author: text('author').notNull(),\n  text: text('text').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const photos = pgTable('photos', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  url: text('url').notNull(),\n  caption: text('caption'),\n  albumId: integer('album_id'),\n  liked: boolean('liked').default(false),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const albums = pgTable('albums', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  title: text('title').notNull(),\n  thumbnail: text('thumbnail'),\n  eventDate: timestamp('event_date'),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const notifications = pgTable('notifications', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  type: text('type').notNull(),\n  title: text('title').notNull(),\n  message: text('message').notNull(),\n  isRead: boolean('is_read').default(false),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const expenses = pgTable('expenses', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  title: text('title').notNull(),\n  amount: numeric('amount').notNull(),\n  category: text('category').notNull(),\n  isPaid: boolean('is_paid').default(false),\n  memo: text('memo'),\n  date: timestamp('date').notNull(),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const checklistItems = pgTable('checklist_items', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  category: text('category').notNull(),\n  title: text('title').notNull(),\n  completed: boolean('completed').default(false),\n  dueDate: timestamp('due_date'),\n  priority: text('priority').default('medium'),\n  mode: text('mode').notNull(),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const travels = pgTable('travels', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  title: text('title').notNull(),\n  destination: text('destination').notNull(),\n  startDate: timestamp('start_date').notNull(),\n  endDate: timestamp('end_date').notNull(),\n  thumbnail: text('thumbnail'),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const travelSchedules = pgTable('travel_schedules', {\n  id: serial('id').primaryKey(),\n  travelId: integer('travel_id').notNull(),\n  day: integer('day').notNull(),\n  time: text('time'),\n  title: text('title').notNull(),\n  location: text('location'),\n  memo: text('memo'),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const widgets = pgTable('widgets', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  type: text('type').notNull(),\n  isEnabled: boolean('is_enabled').default(true),\n  settings: text('settings'),\n});\n\nexport const weddingInfo = pgTable('wedding_info', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  weddingDate: text('wedding_date'),\n  weddingTime: text('wedding_time'),\n  venue: text('venue'),\n  expectedGuests: integer('expected_guests'),\n  groomGuests: integer('groom_guests').default(0),\n  brideGuests: integer('bride_guests').default(0),\n  mealCostAdult: integer('meal_cost_adult').default(0),\n  mealCostChild: integer('meal_cost_child').default(0),\n  invitationCount: integer('invitation_count').default(0),\n  physicalInvitationCount: integer('physical_invitation_count').default(0),\n  invitationData: jsonb('invitation_data'),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const guests = pgTable('guests', {\n  id: serial('id').primaryKey(),\n  userId: text('user_id').notNull(),\n  name: text('name').notNull(),\n  side: text('side').notNull(),\n  relationship: text('relationship'),\n  attendance: text('attendance').default('pending'),\n  invitationSent: boolean('invitation_sent').default(false),\n  mealType: text('meal_type').default('adult'),\n  giftAmount: integer('gift_amount').default(0),\n  memo: text('memo'),\n  phone: text('phone'),\n  createdAt: timestamp('created_at').defaultNow(),\n});\n\nexport const sessions = pgTable('sessions', {\n  sid: varchar('sid').primaryKey(),\n  sess: jsonb('sess').notNull(),\n  expire: timestamp('expire').notNull(),\n});\n\nexport type User = typeof users.$inferSelect;\nexport type Profile = typeof profiles.$inferSelect;\nexport type Event = typeof events.$inferSelect;\nexport type Todo = typeof todos.$inferSelect;\nexport type TodoComment = typeof todoComments.$inferSelect;\nexport type Photo = typeof photos.$inferSelect;\nexport type Album = typeof albums.$inferSelect;\nexport type Notification = typeof notifications.$inferSelect;\nexport type Expense = typeof expenses.$inferSelect;\nexport type ChecklistItem = typeof checklistItems.$inferSelect;\nexport type Travel = typeof travels.$inferSelect;\nexport type TravelSchedule = typeof travelSchedules.$inferSelect;\nexport type Widget = typeof widgets.$inferSelect;\nexport type WeddingInfo = typeof weddingInfo.$inferSelect;\nexport type Guest = typeof guests.$inferSelect;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 488, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/db/index.ts"],"sourcesContent":["import { drizzle } from 'drizzle-orm/node-postgres';\nimport pg from 'pg';\nimport * as schema from './schema';\n\nconst { Pool } = pg;\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,EAAE,IAAI,EAAE,GAAG,+GAAE;AAEnB,MAAM,OAAO,IAAI,KAAK;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,MAAM,KAAK,IAAA,yKAAO,EAAC,MAAM;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 517, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/stripe/products/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { ensureStripeInitialized } from '@/lib/stripe-init';\nimport { db } from '@/db';\nimport { sql } from 'drizzle-orm';\n\nexport async function GET() {\n  try {\n    await ensureStripeInitialized();\n\n    const result = await db.execute(sql`\n      SELECT \n        p.id as product_id,\n        p.name as product_name,\n        p.description as product_description,\n        p.metadata as product_metadata,\n        pr.id as price_id,\n        pr.unit_amount,\n        pr.currency,\n        pr.recurring,\n        pr.metadata as price_metadata\n      FROM stripe.products p\n      LEFT JOIN stripe.prices pr ON pr.product = p.id AND pr.active = true\n      WHERE p.active = true\n      ORDER BY p.name, pr.unit_amount\n    `);\n\n    const productsMap = new Map();\n    for (const row of result.rows) {\n      const r = row as any;\n      if (!productsMap.has(r.product_id)) {\n        productsMap.set(r.product_id, {\n          id: r.product_id,\n          name: r.product_name,\n          description: r.product_description,\n          metadata: r.product_metadata,\n          prices: [],\n        });\n      }\n      if (r.price_id) {\n        productsMap.get(r.product_id).prices.push({\n          id: r.price_id,\n          unit_amount: r.unit_amount,\n          currency: r.currency,\n          recurring: r.recurring,\n          metadata: r.price_metadata,\n        });\n      }\n    }\n\n    return NextResponse.json({ products: Array.from(productsMap.values()) });\n  } catch (error: any) {\n    console.error('Products fetch error:', error);\n    return NextResponse.json({ products: [] });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,IAAA,kJAAuB;QAE7B,MAAM,SAAS,MAAM,mHAAE,CAAC,OAAO,CAAC,qJAAG,CAAC;;;;;;;;;;;;;;;IAepC,CAAC;QAED,MAAM,cAAc,IAAI;QACxB,KAAK,MAAM,OAAO,OAAO,IAAI,CAAE;YAC7B,MAAM,IAAI;YACV,IAAI,CAAC,YAAY,GAAG,CAAC,EAAE,UAAU,GAAG;gBAClC,YAAY,GAAG,CAAC,EAAE,UAAU,EAAE;oBAC5B,IAAI,EAAE,UAAU;oBAChB,MAAM,EAAE,YAAY;oBACpB,aAAa,EAAE,mBAAmB;oBAClC,UAAU,EAAE,gBAAgB;oBAC5B,QAAQ,EAAE;gBACZ;YACF;YACA,IAAI,EAAE,QAAQ,EAAE;gBACd,YAAY,GAAG,CAAC,EAAE,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC;oBACxC,IAAI,EAAE,QAAQ;oBACd,aAAa,EAAE,WAAW;oBAC1B,UAAU,EAAE,QAAQ;oBACpB,WAAW,EAAE,SAAS;oBACtB,UAAU,EAAE,cAAc;gBAC5B;YACF;QACF;QAEA,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE,UAAU,MAAM,IAAI,CAAC,YAAY,MAAM;QAAI;IACxE,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE,UAAU,EAAE;QAAC;IAC1C;AACF"}}]
}