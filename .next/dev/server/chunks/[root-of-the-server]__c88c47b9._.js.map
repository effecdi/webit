{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/stripe-client.ts"],"sourcesContent":["import Stripe from 'stripe';\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  const connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n  return new Stripe(secretKey, {\n    apiVersion: '2025-08-27.basil' as any,\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,eAAe;IACb,MAAM,WAAW,QAAQ,GAAG,CAAC,0BAA0B;IACvD,MAAM,eAAe,QAAQ,GAAG,CAAC,aAAa,GAC1C,UAAU,QAAQ,GAAG,CAAC,aAAa,GACnC,QAAQ,GAAG,CAAC,gBAAgB,GAC1B,UAAU,QAAQ,GAAG,CAAC,gBAAgB,GACtC;IAEN,IAAI,CAAC,cAAc;QACjB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,gBAAgB;IACtB,MAAM,eAAe,QAAQ,GAAG,CAAC,iBAAiB,KAAK;IACvD,MAAM,oBAAoB,eAAe,eAAe;IAExD,MAAM,MAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,SAAS,kBAAkB,CAAC;IAC3D,IAAI,YAAY,CAAC,GAAG,CAAC,mBAAmB;IACxC,IAAI,YAAY,CAAC,GAAG,CAAC,mBAAmB;IACxC,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe;IAEpC,MAAM,WAAW,MAAM,MAAM,IAAI,QAAQ,IAAI;QAC3C,SAAS;YACP,UAAU;YACV,kBAAkB;QACpB;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,MAAM,qBAAqB,KAAK,KAAK,EAAE,CAAC,EAAE;IAE1C,IAAI,CAAC,sBAAuB,CAAC,mBAAmB,QAAQ,CAAC,WAAW,IAAI,CAAC,mBAAmB,QAAQ,CAAC,MAAM,EAAG;QAC5G,MAAM,IAAI,MAAM,CAAC,OAAO,EAAE,kBAAkB,qBAAqB,CAAC;IACpE;IAEA,OAAO;QACL,gBAAgB,mBAAmB,QAAQ,CAAC,WAAW;QACvD,WAAW,mBAAmB,QAAQ,CAAC,MAAM;IAC/C;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,OAAO,IAAI,0PAAM,CAAC,WAAW;QAC3B,YAAY;IACd;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,cAAc,EAAE,GAAG,MAAM;IACjC,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,OAAO;AACT;AAEA,IAAI,aAAkB;AAEf,eAAe;IACpB,IAAI,CAAC,YAAY;QACf,MAAM,EAAE,UAAU,EAAE,GAAG;QACvB,MAAM,YAAY,MAAM;QAExB,aAAa,IAAI,WAAW;YAC1B,YAAY;gBACV,kBAAkB,QAAQ,GAAG,CAAC,YAAY;gBAC1C,KAAK;YACP;YACA,iBAAiB;QACnB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/stripe/products/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getUncachableStripeClient } from '@/lib/stripe-client';\n\nexport async function GET() {\n  try {\n    const stripe = await getUncachableStripeClient();\n\n    const [products, prices] = await Promise.all([\n      stripe.products.list({ active: true, limit: 10 }),\n      stripe.prices.list({ active: true, limit: 30 }),\n    ]);\n\n    const productList = products.data.map((p) => ({\n      id: p.id,\n      name: p.name,\n      description: p.description,\n      metadata: p.metadata,\n      prices: prices.data\n        .filter((pr) => pr.product === p.id)\n        .map((pr) => ({\n          id: pr.id,\n          unit_amount: pr.unit_amount,\n          currency: pr.currency,\n          recurring: pr.recurring ? { interval: pr.recurring.interval, interval_count: pr.recurring.interval_count } : null,\n          metadata: pr.metadata,\n        })),\n    }));\n\n    return NextResponse.json({ products: productList });\n  } catch (error: any) {\n    console.error('Products fetch error:', error);\n    return NextResponse.json({ products: [] });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,sJAAyB;QAE9C,MAAM,CAAC,UAAU,OAAO,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC3C,OAAO,QAAQ,CAAC,IAAI,CAAC;gBAAE,QAAQ;gBAAM,OAAO;YAAG;YAC/C,OAAO,MAAM,CAAC,IAAI,CAAC;gBAAE,QAAQ;gBAAM,OAAO;YAAG;SAC9C;QAED,MAAM,cAAc,SAAS,IAAI,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;gBAC5C,IAAI,EAAE,EAAE;gBACR,MAAM,EAAE,IAAI;gBACZ,aAAa,EAAE,WAAW;gBAC1B,UAAU,EAAE,QAAQ;gBACpB,QAAQ,OAAO,IAAI,CAChB,MAAM,CAAC,CAAC,KAAO,GAAG,OAAO,KAAK,EAAE,EAAE,EAClC,GAAG,CAAC,CAAC,KAAO,CAAC;wBACZ,IAAI,GAAG,EAAE;wBACT,aAAa,GAAG,WAAW;wBAC3B,UAAU,GAAG,QAAQ;wBACrB,WAAW,GAAG,SAAS,GAAG;4BAAE,UAAU,GAAG,SAAS,CAAC,QAAQ;4BAAE,gBAAgB,GAAG,SAAS,CAAC,cAAc;wBAAC,IAAI;wBAC7G,UAAU,GAAG,QAAQ;oBACvB,CAAC;YACL,CAAC;QAED,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE,UAAU;QAAY;IACnD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE,UAAU,EAAE;QAAC;IAC1C;AACF"}}]
}