{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/ai/invitation-text/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\ntype TextType = \"title\" | \"message\" | \"fundingMessage\" | \"fundingThanks\" | \"noticeTitle\" | \"endingContent\";\n\nconst SYSTEM_PROMPT = `당신은 한국 결혼식 청첩장 문구 전문 카피라이터입니다.\n아름답고 정제된 한국어로 청첩장에 어울리는 문구를 작성합니다.\n- 격식 있으면서도 따뜻한 톤\n- 간결하고 우아한 표현\n- 줄바꿈(\\\\n)으로 적절히 문단 구분\n- 이모지 절대 사용 금지\n- JSON 형식으로 응답: { \"text\": \"생성된 문구\" }`;\n\nfunction getPrompt(type: TextType, context: { groomName?: string; brideName?: string; date?: string; venue?: string }): string {\n  const names = context.groomName && context.brideName\n    ? `신랑: ${context.groomName}, 신부: ${context.brideName}`\n    : \"\";\n  const dateInfo = context.date ? `날짜: ${context.date}` : \"\";\n  const venueInfo = context.venue ? `장소: ${context.venue}` : \"\";\n  const contextStr = [names, dateInfo, venueInfo].filter(Boolean).join(\", \");\n\n  switch (type) {\n    case \"title\":\n      return `청첩장의 제목(타이틀)을 하나만 생성해주세요. 10자 이내의 짧고 인상적인 문구여야 합니다. 예시: \"소중한 날에 초대합니다\", \"사랑으로 하나 되는 날\"${contextStr ? `\\n참고 정보: ${contextStr}` : \"\"}`;\n\n    case \"message\":\n      return `청첩장의 초대 인사말을 하나만 작성해주세요. 3~5문장 정도의 따뜻한 초대 메시지입니다. 줄바꿈(\\\\n)으로 적절히 구분해주세요.${contextStr ? `\\n참고 정보: ${contextStr}` : \"\"}`;\n\n    case \"fundingMessage\":\n      return `축의금/펀딩 안내 문구를 하나만 작성해주세요. 하객분들께 축의금 대신 마음을 모아달라는 정중한 안내입니다. 2~3문장, 줄바꿈(\\\\n)으로 구분.${contextStr ? `\\n참고 정보: ${contextStr}` : \"\"}`;\n\n    case \"fundingThanks\":\n      return `축의금/펀딩 감사 인사 문구를 하나만 작성해주세요. 축의금을 보내준 분께 감사하는 짧은 메시지입니다. 2~3문장, 줄바꿈(\\\\n)으로 구분.`;\n\n    case \"noticeTitle\":\n      return `청첩장의 공지사항/안내사항 섹션 제목을 하나만 생성해주세요. 5~10자 이내의 짧은 제목입니다. 예시: \"안내사항\", \"참석 안내\", \"식장 안내\"`;\n\n    case \"endingContent\":\n      return `청첩장의 엔딩(마무리) 메시지를 하나만 작성해주세요. 감사의 마음을 담은 따뜻한 마무리 인사입니다. 2~4문장, 줄바꿈(\\\\n)으로 구분.${contextStr ? `\\n참고 정보: ${contextStr}` : \"\"}`;\n\n    default:\n      return \"청첩장에 어울리는 문구를 하나 작성해주세요.\";\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { type, context = {} } = body as { type: TextType; context?: { groomName?: string; brideName?: string; date?: string; venue?: string } };\n\n    if (!type) {\n      return NextResponse.json({ error: \"type is required\" }, { status: 400 });\n    }\n\n    const prompt = getPrompt(type, context);\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        { role: \"system\", content: SYSTEM_PROMPT },\n        { role: \"user\", content: prompt },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 500,\n    });\n\n    const content = response.choices[0]?.message?.content || \"{}\";\n    let parsed: { text?: string };\n    try {\n      parsed = JSON.parse(content);\n    } catch {\n      parsed = { text: content };\n    }\n\n    return NextResponse.json({ text: parsed.text || \"\" });\n  } catch (error: any) {\n    console.error(\"AI invitation text generation error:\", error);\n    return NextResponse.json(\n      { error: \"AI 문구 생성에 실패했습니다. 잠시 후 다시 시도해주세요.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,4PAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,8BAA8B;IAClD,SAAS,QAAQ,GAAG,CAAC,+BAA+B;AACtD;AAIA,MAAM,gBAAgB,CAAC;;;;;;oCAMa,CAAC;AAErC,SAAS,UAAU,IAAc,EAAE,OAAkF;IACnH,MAAM,QAAQ,QAAQ,SAAS,IAAI,QAAQ,SAAS,GAChD,CAAC,IAAI,EAAE,QAAQ,SAAS,CAAC,MAAM,EAAE,QAAQ,SAAS,EAAE,GACpD;IACJ,MAAM,WAAW,QAAQ,IAAI,GAAG,CAAC,IAAI,EAAE,QAAQ,IAAI,EAAE,GAAG;IACxD,MAAM,YAAY,QAAQ,KAAK,GAAG,CAAC,IAAI,EAAE,QAAQ,KAAK,EAAE,GAAG;IAC3D,MAAM,aAAa;QAAC;QAAO;QAAU;KAAU,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC;IAErE,OAAQ;QACN,KAAK;YACH,OAAO,CAAC,sFAAsF,EAAE,aAAa,CAAC,SAAS,EAAE,YAAY,GAAG,IAAI;QAE9I,KAAK;YACH,OAAO,CAAC,wEAAwE,EAAE,aAAa,CAAC,SAAS,EAAE,YAAY,GAAG,IAAI;QAEhI,KAAK;YACH,OAAO,CAAC,iFAAiF,EAAE,aAAa,CAAC,SAAS,EAAE,YAAY,GAAG,IAAI;QAEzI,KAAK;YACH,OAAO,CAAC,8EAA8E,CAAC;QAEzF,KAAK;YACH,OAAO,CAAC,kFAAkF,CAAC;QAE7F,KAAK;YACH,OAAO,CAAC,6EAA6E,EAAE,aAAa,CAAC,SAAS,EAAE,YAAY,GAAG,IAAI;QAErI;YACE,OAAO;IACX;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC,EAAE,GAAG;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gRAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,SAAS,UAAU,MAAM;QAE/B,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS;gBAAc;gBACzC;oBAAE,MAAM;oBAAQ,SAAS;gBAAO;aACjC;YACD,iBAAiB;gBAAE,MAAM;YAAc;YACvC,YAAY;QACd;QAEA,MAAM,UAAU,SAAS,OAAO,CAAC,EAAE,EAAE,SAAS,WAAW;QACzD,IAAI;QACJ,IAAI;YACF,SAAS,KAAK,KAAK,CAAC;QACtB,EAAE,OAAM;YACN,SAAS;gBAAE,MAAM;YAAQ;QAC3B;QAEA,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE,MAAM,OAAO,IAAI,IAAI;QAAG;IACrD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,gRAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}