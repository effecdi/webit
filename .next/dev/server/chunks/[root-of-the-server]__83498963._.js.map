{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/chatbot/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nconst SYSTEM_PROMPT = `당신은 WE:VE(위브) 앱의 AI 고객지원 상담사입니다.\nWE:VE는 커플의 연애, 결혼, 가정 생활을 지원하는 한국어 모바일 앱입니다.\n\n앱의 주요 기능:\n- 데이팅 모드: 커플 캘린더, 포토 갤러리, 투두리스트, D-Day 추적\n- 웨딩 모드: 예산 관리, 체크리스트, 디지털 청첩장 편집기(9가지 템플릿), 하객 관리\n- 패밀리 모드: 추억 아카이브, 공유 캘린더, 사진 정리\n- 여행 모듈: 여행 계획, 일정, 체크리스트, 예산 관리\n- 구독 시스템: Advanced/Premium 멤버십\n- 카카오톡/구글 소셜 로그인\n\n상담 지침:\n- 친절하고 따뜻한 톤으로 답변하세요\n- 간결하고 이해하기 쉬운 한국어를 사용하세요\n- 앱 기능에 대한 질문에 정확하게 답변하세요\n- 기술적 문제는 가능한 해결 방법을 안내하세요\n- 답변을 모르면 솔직히 말하고, 추가 문의를 안내하세요\n- 이모지를 사용하지 마세요\n- 답변은 300자 이내로 간결하게 해주세요`;\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { messages } = await request.json();\n\n    if (!messages || !Array.isArray(messages) || messages.length === 0) {\n      return NextResponse.json({ error: \"messages required\" }, { status: 400 });\n    }\n\n    const chatMessages = [\n      { role: \"system\" as const, content: SYSTEM_PROMPT },\n      ...messages.map((m: { role: string; content: string }) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      })),\n    ];\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: chatMessages,\n      max_completion_tokens: 500,\n    });\n\n    const reply = response.choices[0]?.message?.content || \"죄송합니다. 일시적인 오류가 발생했습니다. 다시 시도해주세요.\";\n\n    return NextResponse.json({ reply });\n  } catch (error) {\n    console.error(\"Chatbot error:\", error);\n    return NextResponse.json(\n      { error: \"AI 응답을 가져오는 중 오류가 발생했습니다.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,+QAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,8BAA8B;IAClD,SAAS,QAAQ,GAAG,CAAC,+BAA+B;AACtD;AAEA,MAAM,gBAAgB,CAAC;;;;;;;;;;;;;;;;;;wBAkBC,CAAC;AAElB,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEvC,IAAI,CAAC,YAAY,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,GAAG;YAClE,OAAO,gRAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,eAAe;YACnB;gBAAE,MAAM;gBAAmB,SAAS;YAAc;eAC/C,SAAS,GAAG,CAAC,CAAC,IAAyC,CAAC;oBACzD,MAAM,EAAE,IAAI;oBACZ,SAAS,EAAE,OAAO;gBACpB,CAAC;SACF;QAED,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;YACV,uBAAuB;QACzB;QAEA,MAAM,QAAQ,SAAS,OAAO,CAAC,EAAE,EAAE,SAAS,WAAW;QAEvD,OAAO,gRAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gRAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}